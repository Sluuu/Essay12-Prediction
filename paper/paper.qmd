---
title: ""
subtitle: "My subtitle if needed"
author: 
  - Sean Liu
thanks: "Code and data are available at: LINK."
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(nflverse)
library(dplyr)
library(tidyr)
library(randomForest)
library(lubridate)
```


# Introduction

You can and should cross-reference sections and sub-sections. We use @citeR and @rohan.

The remainder of this paper is structured as follows. @sec-data....
```{r}
#| echo: false
#| include: true
#| message: false

## Read in the data
cleaned_data <-
  load_player_stats(seasons = 2023) |> 
  filter(season_type == "REG" & position == "QB" & week <= 9)

```



# Data {#sec-data}

Some of our data is of penguins (@fig-bills), from @palmerpenguins.

```{r}
#| label: fig-bills
#| fig-cap: Bills of penguins
#| echo: false

cleaned_data

```

Talk more about it.

And also planes (@fig-planes). (You can change the height and width, but don't worry about doing that until you have finished every other aspect of the paper - Quarto will try to make it look nice and the defaults usually work well once you have enough text.)

```{r}
#| label: fig-planes
#| fig-cap: Relationship between wing length and width
#| echo: false
#| warning: false
#| message: false

# Calculate rolling averages for passing EPA
qb_stats <- cleaned_data %>%
  group_by(player_id) %>%
  arrange(week) %>%
  mutate(rolling_passing_epa = mean(passing_epa, 3, fill = NA, align = 'right')
  )

qb_stats_NA <- drop_na(qb_stats, c("passing_epa"))


# Include more features like opponent defense quality, player health status, etc.
# This is a placeholder for additional feature engineering
# qb_stats <- qb_stats %>%
#   mutate(opponent_defense = ...,
#          player_health = ...)

# Split the data into training and testing sets
# Let's assume we're using Weeks 1-7 for training and Weeks 8-9 for validation
training_set <- qb_stats_NA %>% filter(week <= 7)
validation_set <- qb_stats_NA %>% filter(week > 7 & week <= 9)

# Model Training
# We'll predict the rolling_passing_epa as our target variable
set.seed(123) # for reproducibility
rf_model <- randomForest(passing_epa ~ . -player_id -week -passing_epa, data = training_set, importance = TRUE, ntree = 500)

# Model Evaluation
# Predict on the validation set
validation_predictions <- predict(rf_model, newdata = validation_set)

# Evaluate the model performance using appropriate metrics, e.g., RMSE
rmse <- sqrt(mean((validation_set$rolling_passing_epa - validation_predictions)^2))
print(paste("Validation RMSE:", rmse))

# Feature Importance
importance(rf_model)

# Forecasting for Weeks 10-18
# You would need to prepare the feature set for Weeks 10-18 in the same way as the training set
# Here's a placeholder for the forecasting process

# weeks_10_18_data <- ...
# weeks_10_18_predictions <- predict(rf_model, newdata = weeks_10_18_data)

# Output the predictions
# print(weeks_10_18_predictions)
```

Talk way more about it. 



# Model

The goal of our modelling strategy is twofold. Firstly,...

Here we briefly describe the Bayesian analysis model used to investigate... Background details and diagnostics are included in [Appendix -@sec-model-details].





\newpage


# References


